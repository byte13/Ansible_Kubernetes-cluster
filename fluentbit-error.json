
{"changed": false, "msg": "AnsibleError: template error while templating string: unexpected '.'. String: # Default values for fluent-bit\n\n# kind -- DaemonSet or Deployment\nkind: DaemonSet\n\n# replicaCount -- Only applicable if kind=Deployment\nreplicaCount: 1\n\nimage:\n  repository: cr.fluentbit.io/fluent/fluent-bit\n  # Overrides the image tag whose default is {{ .Chart.AppVersion }}\n  # Set to \"-\" to not use the default value\n  tag:\n  digest:\n  pullPolicy: IfNotPresent\n\ntestFramework:\n  enabled: true\n  namespace:\n  image:\n    repository: busybox\n    pullPolicy: Always\n    tag: latest\n    digest:\n\nimagePullSecrets: []\nnameOverride: \"\"\nfullnameOverride: \"\"\n\nserviceAccount:\n  create: true\n  annotations: {}\n  name:\n\nrbac:\n  create: true\n  nodeAccess: false\n  eventsAccess: false\n\n# Configure podsecuritypolicy\n# Ref: https://kubernetes.io/docs/concepts/policy/pod-security-policy/\n# from Kubernetes 1.25, PSP is deprecated\n# See: https://kubernetes.io/blog/2022/08/23/kubernetes-v1-25-release/#pod-security-changes\n# We automatically disable PSP if Kubernetes version is 1.25 or higher\npodSecurityPolicy:\n  create: false\n  annotations: {}\n\n# OpenShift-specific configuration\nopenShift:\n  enabled: false\n  securityContextConstraints:\n    # Create SCC for Fluent-bit and allow use it\n    create: true\n    name: \"\"\n    annotations: {}\n    # Use existing SCC in cluster, rather then create new one\n    existingName: \"\"\n\npodSecurityContext: {}\n#   fsGroup: 2000\n\nhostNetwork: false\ndnsPolicy: ClusterFirst\n\ndnsConfig: {}\n#   nameservers:\n#     - 1.2.3.4\n#   searches:\n#     - ns1.svc.cluster-domain.example\n#     - my.dns.search.suffix\n#   options:\n#     - name: ndots\n#       value: \"2\"\n#     - name: edns0\n\nhostAliases: []\n#   - ip: \"1.2.3.4\"\n#     hostnames:\n#     - \"foo.local\"\n#     - \"bar.local\"\n\nsecurityContext: {}\n#   capabilities:\n#     drop:\n#     - ALL\n#   readOnlyRootFilesystem: true\n#   runAsNonRoot: true\n#   runAsUser: 1000\n\nservice:\n  type: ClusterIP\n  port: 2020\n  internalTrafficPolicy:\n  loadBalancerClass:\n  loadBalancerSourceRanges: []\n  labels: {}\n  # nodePort: 30020\n  # clusterIP: 172.16.10.1\n  annotations: {}\n#   prometheus.io/path: \"/api/v1/metrics/prometheus\"\n#   prometheus.io/port: \"2020\"\n#   prometheus.io/scrape: \"true\"\n  externalIPs: []\n  # externalIPs:\n  #  - 2.2.2.2\n\n\nserviceMonitor:\n  enabled: false\n  #   namespace: monitoring\n  #   interval: 10s\n  #   scrapeTimeout: 10s\n  #   selector:\n  #    prometheus: my-prometheus\n  #  ## metric relabel configs to apply to samples before ingestion.\n  #  ##\n  #  metricRelabelings:\n  #    - sourceLabels: [__meta_kubernetes_service_label_cluster]\n  #      targetLabel: cluster\n  #      regex: (.*)\n  #      replacement: ${1}\n  #      action: replace\n  #  ## relabel configs to apply to samples after ingestion.\n  #  ##\n  #  relabelings:\n  #    - sourceLabels: [__meta_kubernetes_pod_node_name]\n  #      separator: ;\n  #      regex: ^(.*)$\n  #      targetLabel: nodename\n  #      replacement: $1\n  #      action: replace\n  #  scheme: \"\"\n  #  tlsConfig: {}\n\n  ## Bear in mind if you want to collect metrics from a different port\n  ## you will need to configure the new ports on the extraPorts property.\n  additionalEndpoints: []\n  # - port: metrics\n  #   path: /metrics\n  #   interval: 10s\n  #   scrapeTimeout: 10s\n  #   scheme: \"\"\n  #   tlsConfig: {}\n  #   # metric relabel configs to apply to samples before ingestion.\n  #   #\n  #   metricRelabelings:\n  #     - sourceLabels: [__meta_kubernetes_service_label_cluster]\n  #       targetLabel: cluster\n  #       regex: (.*)\n  #       replacement: ${1}\n  #       action: replace\n  #   # relabel configs to apply to samples after ingestion.\n  #   #\n  #   relabelings:\n  #     - sourceLabels: [__meta_kubernetes_pod_node_name]\n  #       separator: ;\n  #       regex: ^(.*)$\n  #       targetLabel: nodename\n  #       replacement: $1\n  #       action: replace\n\nprometheusRule:\n  enabled: false\n#   namespace: \"\"\n#   additionalLabels: {}\n#   rules:\n#   - alert: NoOutputBytesProcessed\n#     expr: rate(fluentbit_output_proc_bytes_total[5m]) == 0\n#     annotations:\n#       message: |\n#         Fluent Bit instance {{ $labels.instance }}'s output plugin {{ $labels.name }} has not processed any\n#         bytes for at least 15 minutes.\n#       summary: No Output Bytes Processed\n#     for: 15m\n#     labels:\n#       severity: critical\n\ndashboards:\n  enabled: false\n  labelKey: grafana_dashboard\n  labelValue: 1\n  annotations: {}\n  namespace: \"\"\n  deterministicUid: false\n\nlifecycle: {}\n#   preStop:\n#     exec:\n#       command: [\"/bin/sh\", \"-c\", \"sleep 20\"]\n\nlivenessProbe:\n  httpGet:\n    path: /\n    port: http\n\nreadinessProbe:\n  httpGet:\n    path: /api/v1/health\n    port: http\n\nresources: {}\n#   limits:\n#     cpu: 100m\n#     memory: 128Mi\n#   requests:\n#     cpu: 100m\n#     memory: 128Mi\n\n## only available if kind is Deployment\ningress:\n  enabled: false\n  ingressClassName: \"\"\n  annotations: {}\n  #  kubernetes.io/ingress.class: nginx\n  #  kubernetes.io/tls-acme: \"true\"\n  hosts: []\n  # - host: fluent-bit.example.tld\n  extraHosts: []\n  # - host: fluent-bit-extra.example.tld\n  ## specify extraPort number\n  #   port: 5170\n  tls: []\n  #  - secretName: fluent-bit-example-tld\n  #    hosts:\n  #      - fluent-bit.example.tld\n\n## only available if kind is Deployment\nautoscaling:\n  vpa:\n    enabled: false\n\n    annotations: {}\n\n    # List of resources that the vertical pod autoscaler can control. Defaults to cpu and memory\n    controlledResources: []\n\n    # Define the max allowed resources for the pod\n    maxAllowed: {}\n    # cpu: 200m\n    # memory: 100Mi\n    # Define the min allowed resources for the pod\n    minAllowed: {}\n    # cpu: 200m\n    # memory: 100Mi\n\n    updatePolicy:\n      # Specifies whether recommended updates are applied when a Pod is started and whether recommended updates\n      # are applied during the life of a Pod. Possible values are \"Off\", \"Initial\", \"Recreate\", and \"Auto\".\n      updateMode: Auto\n\n  enabled: false\n  minReplicas: 1\n  maxReplicas: 3\n  targetCPUUtilizationPercentage: 75\n  #  targetMemoryUtilizationPercentage: 75\n  ## see https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/#autoscaling-on-multiple-metrics-and-custom-metrics\n  customRules: []\n  #     - type: Pods\n  #       pods:\n  #         metric:\n  #           name: packets-per-second\n  #         target:\n  #           type: AverageValue\n  #           averageValue: 1k\n  ## see https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/#support-for-configurable-scaling-behavior\n  behavior: {}\n#      scaleDown:\n#        policies:\n#          - type: Pods\n#            value: 4\n#            periodSeconds: 60\n#          - type: Percent\n#            value: 10\n#            periodSeconds: 60\n\n## only available if kind is Deployment\npodDisruptionBudget:\n  enabled: false\n  annotations: {}\n  maxUnavailable: \"30%\"\n\nnodeSelector: {}\n\ntolerations: []\n\naffinity: {}\n\nlabels: {}\n\nannotations: {}\n\npodAnnotations: {}\n\npodLabels: {}\n\n## How long (in seconds) a pods needs to be stable before progressing the deployment\n##\nminReadySeconds:\n\n## How long (in seconds) a pod may take to exit (useful with lifecycle hooks to ensure lb deregistration is done)\n##\nterminationGracePeriodSeconds:\n\npriorityClassName: \"\"\n\nenv: []\n#  - name: FOO\n#    value: \"bar\"\n\n# The envWithTpl array below has the same usage as \"env\", but is using the tpl function to support templatable string.\n# This can be useful when you want to pass dynamic values to the Chart using the helm argument \"--set <variable>=<value>\"\n# https://helm.sh/docs/howto/charts_tips_and_tricks/#using-the-tpl-function\nenvWithTpl: []\n#  - name: FOO_2\n#    value: \"{{ .Values.foo2 }}\"\n#\n# foo2: bar2\n\nenvFrom: []\n\n# This supports either a structured array or a templatable string\nextraContainers: []\n\n# Array mode\n# extraContainers:\n#   - name: do-something\n#     image: busybox\n#     command: ['do', 'something']\n\n# String mode\n# extraContainers: |-\n#   - name: do-something\n#     image: bitnami/kubectl:{{ .Capabilities.KubeVersion.Major }}.{{ .Capabilities.KubeVersion.Minor }}\n#     command: ['kubectl', 'version']\n\nflush: 1\n\nmetricsPort: 2020\n\nextraPorts: []\n#   - port: 5170\n#     containerPort: 5170\n#     protocol: TCP\n#     name: tcp\n#     nodePort: 30517\n\nextraVolumes: []\n\nextraVolumeMounts: []\n\nupdateStrategy: {}\n#   type: RollingUpdate\n#   rollingUpdate:\n#     maxUnavailable: 1\n\n# Make use of a pre-defined configmap instead of the one templated here\nexistingConfigMap: \"\"\n\nnetworkPolicy:\n  enabled: false\n#   ingress:\n#     from: []\n\nluaScripts: {}\n\n## https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/classic-mode/configuration-file\nconfig:\n  service: |\n    [SERVICE]\n        Daemon Off\n        Flush {{ .Values.flush }}\n        Log_Level {{ .Values.logLevel }}\n        Parsers_File /fluent-bit/etc/parsers.conf\n        Parsers_File /fluent-bit/etc/conf/custom_parsers.conf\n        HTTP_Server On\n        HTTP_Listen 0.0.0.0\n        HTTP_Port {{ .Values.metricsPort }}\n        Health_Check On\n\n  ## https://docs.fluentbit.io/manual/pipeline/inputs\n  inputs: |\n    [INPUT]\n        Name tail\n        Path /var/log/pods/*/*.log \n        multiline.parser docker, cri\n        Tag kube.*\n        Mem_Buf_Limit 5MB\n        Skip_Long_Lines On\n\n    [INPUT]\n        Name systemd\n        Tag host.*\n        Systemd_Filter _SYSTEMD_UNIT=kubelet.service\n        Read_From_Tail On\n\n  ## https://docs.fluentbit.io/manual/pipeline/filters\n  filters: |\n    [FILTER]\n        Name kubernetes\n        Match kube.*\n        Merge_Log On\n        Keep_Log Off\n        K8S-Logging.Parser On\n        K8S-Logging.Exclude On\n\n  ## https://docs.fluentbit.io/manual/pipeline/outputs\n  outputs: |\n    [OUTPUT]\n        Name opensearch\n        Match kube.*\n        Host {{ global_opensearch-master_fqdn }}\n        Logstash_Format On\n        Retry_Limit False\n\n    [OUTPUT]\n        Name opensearch\n        Match host.*\n        Host {{ global_opensearch-master_fqdn }}\n        Logstash_Format On\n        Logstash_Prefix node\n        Retry_Limit False\n\n  ## https://docs.fluentbit.io/manual/administration/configuring-fluent-bit/classic-mode/upstream-servers\n  ## This configuration is deprecated, please use `extraFiles` instead.\n  upstream: {}\n\n  ## https://docs.fluentbit.io/manual/pipeline/parsers\n  customParsers: |\n    [PARSER]\n        Name docker_no_time\n        Format json\n        Time_Keep Off\n        Time_Key time\n        Time_Format %Y-%m-%dT%H:%M:%S.%L\n\n  # This allows adding more files with arbitrary filenames to /fluent-bit/etc/conf by providing key/value pairs.\n  # The key becomes the filename, the value becomes the file content.\n  extraFiles: {}\n#     upstream.conf: |\n#       [UPSTREAM]\n#           upstream1\n#\n#       [NODE]\n#           name       node-1\n#           host       127.0.0.1\n#           port       43000\n#     example.conf: |\n#       [OUTPUT]\n#           Name example\n#           Match foo.*\n#           Host bar\n\n# The config volume is mounted by default, either to the existingConfigMap value, or the default of \"fluent-bit.fullname\"\nvolumeMounts:\n  - name: config\n    mountPath: /fluent-bit/etc/conf\n\ndaemonSetVolumes:\n  - name: varlog\n    hostPath:\n      path: /var/log\n  - name: varlibdockercontainers\n    hostPath:\n      path: /var/lib/docker/containers\n  - name: etcmachineid\n    hostPath:\n      path: /etc/machine-id\n      type: File\n\ndaemonSetVolumeMounts:\n  - name: varlog\n    mountPath: /var/log\n  - name: varlibdockercontainers\n    mountPath: /var/lib/docker/containers\n    readOnly: true\n  - name: etcmachineid\n    mountPath: /etc/machine-id\n    readOnly: true\n\ncommand:\n  - /fluent-bit/bin/fluent-bit\n\nargs:\n  - --workdir=/fluent-bit/etc\n  - --config=/fluent-bit/etc/conf/fluent-bit.conf\n\n# This supports either a structured array or a templatable string\ninitContainers: []\n\n# Array mode\n# initContainers:\n#   - name: do-something\n#     image: bitnami/kubectl:1.22\n#     command: ['kubectl', 'version']\n\n# String mode\n# initContainers: |-\n#   - name: do-something\n#     image: bitnami/kubectl:{{ .Capabilities.KubeVersion.Major }}.{{ .Capabilities.KubeVersion.Minor }}\n#     command: ['kubectl', 'version']\n\nlogLevel: info\n\nhotReload:\n  enabled: false\n  image:\n    repository: ghcr.io/jimmidyson/configmap-reload\n    tag: v0.11.1\n    digest:\n    pullPolicy: IfNotPresent\n  resources: {}\n. unexpected '.'"}
